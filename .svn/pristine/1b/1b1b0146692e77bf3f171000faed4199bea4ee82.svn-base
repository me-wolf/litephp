<?php
namespace LITE;
use \Exception as OrgException;

class Exception extends OrgException {
	protected $message;
	protected $code;
	public $trace_info;
	public $data;

	/**
	 * construct exception
	 * @param null $message
	 * @param int $code
	 * @param null $data current context data
	 */
	public function __construct($message=null, $code=0, $data=null){
		parent::__construct($message, 0);
		$this->trace_info = debug_backtrace();
		$this->data = $data;
	}

	/**
	 * debug current exception
	 * @param bool $html_format
	 * @return string
	 */
	public function dump($html_format=true){
		if($html_format){
			$html = '<div style="font-size:14px;">';
			$line = "<br/>";
		} else {
			$html = '<pre>';
			$line = "\n";
		}

		$html .= $this->message.$line;
		$html .= $this->code .$line;
		$html .= print_r($this->data, true);
		$html .= $line.$line.str_repeat('=', 80).$line;
		$c = count($this->trace_info);
		foreach($this->trace_info as $k=>$t){
			if($html_format && $this->isLibFile($t['file'])){
				$html .= '<span style="color:#ccc;">';
			}
			$html .= '[#'.($c-$k).'] '.$t['file']."({$t['line']}) ";
			$html .= $t['class'].$t['type'].$t['function']."()".$line;
			if($html_format && $this->isLibFile($t['file'])){
				$html .= '</span>';
			}
		}
		return $html;
	}

	/**
	 * check file is library file
	 * @param $file
	 * @return bool
	 */
	private function isLibFile($file){
		return stripos($file, 'litephp\lib') !== false;
	}

	/**
	 * convert exception to string
	 * @return string
	 */
	public function __toString(){
		return $this->message;
	}
}