<?php
$PAGE_CLASS .= 'page-user-info';
$PAGE_HEAD .= $this->getCss('user.css');
include 'inc/header.inc.php';
include 'inc/usernav.inc.php';
?>
<style>
	.user-common-frm .pass {display:none}
	.user-common-frm .error {color:red; padding-left:1em;}
</style>
<div class="right-col">
	<h2 class="cap">
		个人资料
	</h2>

	<form action="<?php echo $this->getUrl('user/modify');?>" method="POST" class="frm user-common-frm view-state" id="info-frm" data-trans='async' onresponse="response">
		<div class="avatar">
			<?php $avatar = $this->getConfig('upload/url').($login_user->album ?: 'avatar.jpg');?>
			<a href="<?php echo $this->getImgUrl($avatar)?>" target="_blank">
				<?php echo $this->getImg($avatar)?>
			</a>
			<p>
				<input type="button" value="重设头像" class="btn btn-strong" id="change-avatar-btn"/>
			</p>
		</div>
		<fieldset>
			<dl>
				<dt>
					<label for="name">姓名</label>
				</dt>
				<dd>
					<input type="text" name="name" id="name" value="<?php echo $login_user->name?>" class="txt"/>
				</dd>
			</dl>
			<dl>
				<dt>
					<label for="email">邮箱</label>
				</dt>
				<dd>
					<input type="text" name="email" id="email" value="<?php echo $login_user->email?>" class="txt"/>
				</dd>
			</dl>
			<dl>
				<dt>
					<label for="mobile">手机</label>
				</dt>
				<dd>
					<input type="text" name="mobile" id="mobile" value="<?php echo $login_user->mobile?>" class="txt"/>
				</dd>
			</dl>
			<dl>
				<dt>
					<label for="ethnic">民族</label>
				</dt>
				<dd>
					<input type="text" name="ethnic" id="ethnic" value="<?php echo $login_user->ethnic?>" class="txt"/>
				</dd>
			</dl>
			<dl>
				<dt>
					<label for="hometown">籍贯</label>
				</dt>
				<dd>
					<input type="text" name="hometown" id="hometown" value="<?php echo $login_user->hometown?>" class="txt"/>
				</dd>
			</dl>
			<dl>
				<dt>
					<label for="address">现居住</label>
				</dt>
				<dd>
					<input type="text" name="address" id="address" value="<?php echo $login_user->address?>" class="txt"/>
				</dd>
			</dl>
			<dl>
				<dt>
					<label for="education">最高学历</label>
				</dt>
				<dd>
					<select name="education" id="education">
						<?php
							$arr = array('小学','初中','高中','本科','中专','大专','硕士','博士','其他');
							foreach($arr as $name){
								echo '<option value="'.$val.'"'.($name == $login_user->education ? ' selected': '').'>'.$name.'</option>';
							}
						?>
					</select>
				</dd>
			</dl>
			<dl>
				<dt>
					<label for="height">身高</label>
				</dt>
				<dd>
					<input type="text" name="height" id="height" value="<?php echo $login_user->height?>" class="txt s-txt"/>
					厘米
				</dd>
			</dl>
			<dl>
				<dt>
					<label for="birth">出生日期</label>
				</dt>
				<dd>
					<input type="text" name="birth" id="birth" value="<?php echo $login_user->birth?>" class="txt date-txt"/>
				</dd>
			</dl>
			<dl>
				<dt>
					<label for="marriage">婚姻状况</label>
				</dt>
				<dd>
					<input type="text" name="marriage" id="marriage" class="txt"/>
				</dd>
			</dl>
			<dl>
				<dt>
				</dt>
				<dd>
					<input type="submit" value="保存修改" class="btn btn-disable" disabled="disabled" id="save-btn">
					<input type="button" value="取消" class="btn btn-disable" disabled="disabled" id="cancel-btn"> &nbsp;
				</dd>
			</dl>
		</fieldset>
	</form>
</div>
<script>
var response = function(msg, type, data){
	if(type == 'succ'){
		YSL.showTip(msg, type);
	}
};
(function(Y){
	var changed = false;

	var updateState = function(bChanged){
		Y.dom.one('#save-btn').delAttr('disabled');
		Y.dom.one('#save-btn').getDomNode().className = 'btn btn-strong';
		Y.dom.one('#cancel-btn').delAttr('disabled');
		Y.dom.one('#cancel-btn').getDomNode().className = 'btn btn-weak';
		changed = bChanged;
	};

	Y.dom.all('.user-common-frm input').on('keydown', function(){
		updateState(true);
	});
	Y.dom.all('.user-common-frm input').on('change', function(){
		updateState(true);
	});
	Y.dom.all('.user-common-frm select').on('change', function(){
		updateState(true);
	});

	Y.dom.one('#cancel-btn').on('click', function() {
		if(changed && confirm('是否确定放弃本次修改？')){
			location.reload();
		}
	});

	Y.dom.one('#change-avatar-btn').on('click', function(){
		R.changeAvatar(function(src){
			Y.dom.one('.avatar img').setAttr('src', src);
			//R.scaleAvaImg(Y.dom.one('.avatar img').getDomNode());
		});
	});

	//R.scaleAvaImg(Y.dom.one('.avatar img').getDomNode());

	return ;
	YSL.use('widget.Validator', function(Y, Val){
		var validator = new Val({
			form: '#info-frm',
			rules: {
				'name': {
					require: '请输入姓名',
					min2:'请输入正确格式的姓名'
				},
				'email': {
					'email': function(val,element){
						if(val && !Val.REGS.EMAIL.test(val)){
							return '请输入正确格式的邮箱';
						}
					}
				},
				'mobile': {
					'mobile': function(val,element){
						if(val && !Val.REGS.PHONE.test(val)){
							return '请输入正确手机号码';
						}
					}
				},
				'height': {
					'height': function(val,element){
						if(val && !/^\d+$/g.test(val)){
							return '请输入正确格式的身高';
						}
					}
				}
			}
		});
	});
})(YSL);
</script>
<?php include 'inc/footer.inc.php'?>
